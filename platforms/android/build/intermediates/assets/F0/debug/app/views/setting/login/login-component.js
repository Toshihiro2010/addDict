"use strict";
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var router_2 = require("nativescript-angular/router");
var users_1 = require("../../../models/users/users");
var http = require("http");
var Toast = require("nativescript-toast");
var Sqlite = require("nativescript-sqlite");
var LoginComponent = (function () {
    function LoginComponent(router, routerExtensions) {
        this.router = router;
        this.routerExtensions = routerExtensions;
        this.username = "";
        this.password = "";
        this.status_login = 0;
        this.user = [];
        this.strURL = "http://192.168.3.93:30";
        var self = this;
        new Sqlite("dicts.db").then(function (db) {
            self.database = db;
            console.log("Open database Success");
        }, function (error) {
            console.log("Open DB ERROR", error);
        });
    }
    LoginComponent.prototype.btnLogin = function () {
        var self = this;
        var checkEmpty = self.checkEmpty();
        console.log("empty word  ==>", checkEmpty);
        if (checkEmpty == true) {
            http.request({
                url: self.strURL + "/login/" + self.username + "/" + self.password,
                method: "GET"
            }).then(function (response) {
                var statusCode = response.statusCode;
                console.log("status code => ", statusCode);
                if (statusCode != 200) {
                    var toast = Toast.makeText("ไม่มี user และ password นี้ในระบบ");
                    toast.show();
                }
                else {
                    var obj = response.content.toJSON();
                    //obj = JSON.stringify(obj);
                    //self.rejectList();
                    self.objToDatabase(obj);
                } //end else statusCode
            }, function (e) {
                console.log("error is ", e);
            });
        } // End if checkEmpty
    };
    LoginComponent.prototype.rejectList = function () {
        var self = this;
        var temp = self.user.length;
        for (var i = 0; i < temp; i++) {
            self.user.pop();
        }
    };
    LoginComponent.prototype.objToDatabase = function (objUSer) {
        var self = this;
        self.status_login = 1;
        console.log(objUSer);
        var model_user = new users_1.Users();
        model_user.id = objUSer[0].id;
        model_user.username = objUSer[0].username;
        model_user.name = objUSer[0].name;
        model_user.status = objUSer[0].status;
        var temp_id = model_user.id;
        var temp_username = model_user.username;
        var temp_name = model_user.name;
        var temp_status = model_user.status;
        console.log("object user stringdify => ", JSON.stringify(model_user));
        self.database.all("SELECT * FROM USERS WHERE username = (?)", [temp_username]).then(function (rows) {
            if (rows == "") {
                self.myInsertUser(model_user);
            }
            else {
                self.myChangUser(temp_username);
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    LoginComponent.prototype.btnLogout = function () {
        var self = this;
        console.log("botton Logout => ");
        self.status_login = 0;
    };
    LoginComponent.prototype.myInsertUser = function (model_user) {
        var self = this;
        console.log("My inert user =>");
        self.database.execSQL("INSERT INTO USERS (id , username , name , status , login ) VALUES (? , ? , ? , ? , ?)", [model_user.id, model_user.username, model_user.name, model_user.status, 1]).then(function (word_insert) {
            console.log("INSERT RESULT => ", word_insert);
        }, function (error) {
            console.log("INSERT ERROR => ", error);
        });
    };
    LoginComponent.prototype.myChangUser = function (arg) {
        console.log("My chang User => ", arg);
        var self = this;
        self.database.execSQL("UPDATE USERS SET login = 1 WHERE id = (?) ", [arg], function (err, db) {
            if (err) {
                console.log("error is == > ", err);
            }
            else {
                console.log("Update Success");
            }
        });
    };
    LoginComponent.prototype.btnCheck = function () {
        var self = this;
        var result;
        http.request({
            url: self.strURL + "/users/1",
            method: "GET"
        }).then(function (response) {
            var obj = response.content.toJSON();
            var statusCode = response.statusCode;
            console.log("status code => ", statusCode);
            console.log(JSON.stringify(obj));
        }, function (e) {
            console.log("error is ", e);
        });
    };
    LoginComponent.prototype.httpLogin = function () {
        console.log("on => http Login");
        var self = this;
    };
    LoginComponent.prototype.checkEmpty = function () {
        var self = this;
        console.log("username ===> ", self.username);
        console.log("password ===> ", self.password);
        if (self.username.trim() == "" || self.password.trim() == "") {
            var toast = Toast.makeText("มีช่องว่างนะไอ้โง่");
            toast.show();
            return false;
        }
        else {
            return true;
        }
    };
    return LoginComponent;
}());
LoginComponent = __decorate([
    core_1.Component({
        selector: "Login",
        templateUrl: "views/setting/login/login-component.html",
    }),
    __metadata("design:paramtypes", [router_1.Router, router_2.RouterExtensions])
], LoginComponent);
exports.LoginComponent = LoginComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9naW4tY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibG9naW4tY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxzQ0FBMEM7QUFFMUMsMENBQW1FO0FBQ25FLHNEQUErRDtBQUMvRCxxREFBb0Q7QUFHcEQsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzNCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQzFDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBTzVDLElBQWEsY0FBYztJQVl2Qix3QkFBb0IsTUFBYyxFQUFXLGdCQUFtQztRQUE1RCxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVcscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFtQjtRQVZ4RSxhQUFRLEdBQVksRUFBRSxDQUFFO1FBQ3hCLGFBQVEsR0FBWSxFQUFFLENBQUU7UUFFeEIsaUJBQVksR0FBRyxDQUFDLENBQUM7UUFHakIsU0FBSSxHQUFHLEVBQUUsQ0FBRTtRQUVYLFdBQU0sR0FBWSx3QkFBd0IsQ0FBQztRQUcvQyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsSUFBSSxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsRUFBRTtZQUMxQixJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztZQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDekMsQ0FBQyxFQUFDLFVBQUEsS0FBSztZQUNILE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFHLEtBQUssQ0FBQyxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFBO0lBRU4sQ0FBQztJQUVPLGlDQUFRLEdBQWhCO1FBQ0ksSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLEVB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Q0FBQyxDQUFDO0lBRVAsQ0FBQztJQUVPLGtDQUFTLEdBQWpCO1FBQ0ksT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ2hDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztJQUVwQixDQUFDO0lBRU8sbUNBQVUsR0FBbEI7UUFDSSxJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRyxJQUFJLENBQUMsUUFBUSxDQUFFLENBQUM7UUFDL0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFOUMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBRyxFQUFFLENBQUMsQ0FBQSxDQUFDO1lBRXhELElBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUNqRCxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDYixNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ2pCLENBQUM7UUFBQSxJQUFJLENBQUEsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDaEIsQ0FBQztJQUVMLENBQUM7SUFJTCxxQkFBQztBQUFELENBQUMsQUEzS0QsSUEyS0M7QUEzS1ksY0FBYztJQUoxQixnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLE9BQU87UUFDakIsV0FBVyxFQUFFLDBDQUEwQztLQUMxRCxDQUFDO3FDQWE4QixlQUFNLEVBQThCLHlCQUFnQjtHQVp2RSxjQUFjLENBMksxQjtBQTNLWSx3Q0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwiLi4vLi4vLi4vc2hhcmVkL215RnVuY3Rpb24xXCI7XHJcbmltcG9ydCB7IFJvdXRlciwgTmF2aWdhdGlvbkV4dHJhcyAsIFJvdXRlIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiOyBcclxuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcclxuaW1wb3J0IHsgVXNlcnMgfSBmcm9tIFwiLi4vLi4vLi4vbW9kZWxzL3VzZXJzL3VzZXJzXCI7XHJcblxyXG5cclxudmFyIGh0dHAgPSByZXF1aXJlKFwiaHR0cFwiKTtcclxudmFyIFRvYXN0ID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC10b2FzdFwiKTtcclxudmFyIFNxbGl0ZSA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtc3FsaXRlXCIpO1xyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwiTG9naW5cIixcclxuICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL3NldHRpbmcvbG9naW4vbG9naW4tY29tcG9uZW50Lmh0bWxcIixcclxufSlcclxuZXhwb3J0IGNsYXNzIExvZ2luQ29tcG9uZW50IHtcclxuXHJcbiAgICBwcml2YXRlIHVzZXJuYW1lIDogc3RyaW5nID0gXCJcIiA7XHJcbiAgICBwcml2YXRlIHBhc3N3b3JkIDogc3RyaW5nID0gXCJcIiA7XHJcbiAgICBwcml2YXRlIGRhdGFiYXNlIDogYW55O1xyXG4gICAgcHJpdmF0ZSBzdGF0dXNfbG9naW4gPSAwO1xyXG5cclxuXHJcbiAgICBwcml2YXRlIHVzZXIgPSBbXSA7XHJcblxyXG4gICAgcHJpdmF0ZSBzdHJVUkwgOiBzdHJpbmcgPSBcImh0dHA6Ly8xOTIuMTY4LjMuOTM6MzBcIjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlcjogUm91dGVyICwgcHJpdmF0ZSByb3V0ZXJFeHRlbnNpb25zIDogUm91dGVyRXh0ZW5zaW9ucyApe1xyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICBuZXcgU3FsaXRlKFwiZGljdHMuZGJcIikudGhlbihkYiA9PntcclxuICAgICAgICAgICAgc2VsZi5kYXRhYmFzZSA9IGRiO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk9wZW4gZGF0YWJhc2UgU3VjY2Vzc1wiKTtcclxuICAgICAgICB9LGVycm9yID0+e1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk9wZW4gREIgRVJST1JcIiAsIGVycm9yKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnRuTG9naW4oKXtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGNoZWNrRW1wdHkgPSBzZWxmLmNoZWNrRW1wdHkoKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImVtcHR5IHdvcmQgID09PlwiICwgY2hlY2tFbXB0eSk7XHJcbiAgICAgICAgaWYoIGNoZWNrRW1wdHkgPT0gdHJ1ZSl7XHJcblxyXG4gICAgICAgICAgICBodHRwLnJlcXVlc3QoeyBcclxuICAgICAgICAgICAgICAgIHVybDogc2VsZi5zdHJVUkwgK1wiL2xvZ2luL1wiKyBzZWxmLnVzZXJuYW1lICsgXCIvXCIrc2VsZi5wYXNzd29yZCwgXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIgXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSByZXNwb25zZS5zdGF0dXNDb2RlO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdGF0dXMgY29kZSA9PiBcIiAsIHN0YXR1c0NvZGUpO1xyXG4gICAgICAgICAgICAgICAgaWYoc3RhdHVzQ29kZSAhPSAyMDApe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b2FzdCA9IFRvYXN0Lm1ha2VUZXh0KFwi4LmE4Lih4LmI4Lih4Li1IHVzZXIg4LmB4Lil4LiwIHBhc3N3b3JkIOC4meC4teC5ieC5g+C4meC4o+C4sOC4muC4mlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB0b2FzdC5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gcmVzcG9uc2UuY29udGVudC50b0pTT04oKTtcclxuICAgICAgICAgICAgICAgICAgICAvL29iaiA9IEpTT04uc3RyaW5naWZ5KG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLnJlamVjdExpc3QoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9ialRvRGF0YWJhc2Uob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAvL3NlbGYucm91dGVyRXh0ZW5zaW9ucy5uYXZpZ2F0ZShbXCIuL21haW5cIl0sIHsgY2xlYXJIaXN0b3J5OiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vc2VsZi5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcInVzZXIvbGlzdFwiXSwgeyBjbGVhckhpc3Rvcnk6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICB9Ly9lbmQgZWxzZSBzdGF0dXNDb2RlXHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsvLy8vIEFyZ3VtZW50IChlKSBpcyBFcnJvciFcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgaXMgXCIgLCBlKTsgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9Ly8gRW5kIGlmIGNoZWNrRW1wdHlcclxuICAgICAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgcHJpdmF0ZSByZWplY3RMaXN0KCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGxldCB0ZW1wID0gc2VsZi51c2VyLmxlbmd0aDtcclxuICAgICAgICBmb3IodmFyIGkgPSAwIDsgaSA8IHRlbXA7IGkrKyl7XHJcbiAgICAgICAgICAgIHNlbGYudXNlci5wb3AoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvYmpUb0RhdGFiYXNlKG9ialVTZXIpe1xyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICBzZWxmLnN0YXR1c19sb2dpbiA9IDE7XHJcbiAgICAgICAgY29uc29sZS5sb2cob2JqVVNlcik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IG1vZGVsX3VzZXIgPSBuZXcgVXNlcnMoKTtcclxuICAgICAgICBtb2RlbF91c2VyLmlkID0gb2JqVVNlclswXS5pZDtcclxuICAgICAgICBtb2RlbF91c2VyLnVzZXJuYW1lID0gb2JqVVNlclswXS51c2VybmFtZTtcclxuICAgICAgICBtb2RlbF91c2VyLm5hbWUgPSBvYmpVU2VyWzBdLm5hbWU7XHJcbiAgICAgICAgbW9kZWxfdXNlci5zdGF0dXMgPSBvYmpVU2VyWzBdLnN0YXR1cztcclxuICAgICAgICBcclxuICAgICAgICBsZXQgdGVtcF9pZCA9IG1vZGVsX3VzZXIuaWQ7XHJcbiAgICAgICAgbGV0IHRlbXBfdXNlcm5hbWUgPSBtb2RlbF91c2VyLnVzZXJuYW1lO1xyXG4gICAgICAgIGxldCB0ZW1wX25hbWUgPSBtb2RlbF91c2VyLm5hbWU7XHJcbiAgICAgICAgbGV0IHRlbXBfc3RhdHVzID0gbW9kZWxfdXNlci5zdGF0dXM7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwib2JqZWN0IHVzZXIgc3RyaW5nZGlmeSA9PiBcIiAsIEpTT04uc3RyaW5naWZ5KG1vZGVsX3VzZXIpKTtcclxuICAgICAgICBcclxuICAgICAgICBzZWxmLmRhdGFiYXNlLmFsbChcIlNFTEVDVCAqIEZST00gVVNFUlMgV0hFUkUgdXNlcm5hbWUgPSAoPylcIixbdGVtcF91c2VybmFtZV0pLnRoZW4ocm93cyA9PntcclxuICAgICAgICAgICAgaWYocm93cyA9PVwiXCIpe1xyXG4gICAgICAgICAgICAgICAgc2VsZi5teUluc2VydFVzZXIobW9kZWxfdXNlcik7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgc2VsZi5teUNoYW5nVXNlcih0ZW1wX3VzZXJuYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sZXJyb3IgPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU0VMRUNUIEVSUk9SIFwiICwgZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidG5Mb2dvdXQoKXtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJib3R0b24gTG9nb3V0ID0+IFwiKTtcclxuICAgICAgICBzZWxmLnN0YXR1c19sb2dpbiA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBteUluc2VydFVzZXIobW9kZWxfdXNlcil7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiTXkgaW5lcnQgdXNlciA9PlwiKTtcclxuICAgICAgICBzZWxmLmRhdGFiYXNlLmV4ZWNTUUwoXCJJTlNFUlQgSU5UTyBVU0VSUyAoaWQgLCB1c2VybmFtZSAsIG5hbWUgLCBzdGF0dXMgLCBsb2dpbiApIFZBTFVFUyAoPyAsID8gLCA/ICwgPyAsID8pXCIsIFxyXG4gICAgICAgIFttb2RlbF91c2VyLmlkICxtb2RlbF91c2VyLnVzZXJuYW1lICwgbW9kZWxfdXNlci5uYW1lICwgbW9kZWxfdXNlci5zdGF0dXMgLCAxIF0pLnRoZW4od29yZF9pbnNlcnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgUkVTVUxUID0+IFwiICwgd29yZF9pbnNlcnQgICk7XHJcbiAgICAgICAgICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgRVJST1IgPT4gXCIgLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG15Q2hhbmdVc2VyKGFyZyl7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJNeSBjaGFuZyBVc2VyID0+IFwiICwgYXJnKTtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYuZGF0YWJhc2UuZXhlY1NRTChcIlVQREFURSBVU0VSUyBTRVQgbG9naW4gPSAxIFdIRVJFIGlkID0gKD8pIFwiICxbYXJnXSAsIGZ1bmN0aW9uKGVyciAsIGRiICl7XHJcbiAgICAgICAgICAgIGlmKGVycil7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIGlzID09ID4gXCIgLCBlcnIpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXBkYXRlIFN1Y2Nlc3NcIik7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGJ0bkNoZWNrKCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHZhciByZXN1bHQ7XHJcbiAgICAgICAgaHR0cC5yZXF1ZXN0KHsgXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlbGYuc3RyVVJMICtcIi91c2Vycy8xXCIgLCBcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIiBcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB2YXIgb2JqID0gcmVzcG9uc2UuY29udGVudC50b0pTT04oKTtcclxuICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSByZXNwb25zZS5zdGF0dXNDb2RlO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdGF0dXMgY29kZSA9PiBcIiAsIHN0YXR1c0NvZGUpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShvYmopKTtcclxuXHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsvLy8vIEFyZ3VtZW50IChlKSBpcyBFcnJvciFcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgaXMgXCIgLCBlKTsgIFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGh0dHBMb2dpbigpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwib24gPT4gaHR0cCBMb2dpblwiKTtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tFbXB0eSgpe1xyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICBjb25zb2xlLmxvZyhcInVzZXJuYW1lID09PT4gXCIgLCBzZWxmLnVzZXJuYW1lICk7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJwYXNzd29yZCA9PT0+IFwiICwgc2VsZi5wYXNzd29yZCk7XHJcblxyXG4gICAgICAgIGlmKHNlbGYudXNlcm5hbWUudHJpbSgpID09IFwiXCIgfHwgc2VsZi5wYXNzd29yZC50cmltKCkgPT1cIlwiKXtcclxuICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciB0b2FzdCA9IFRvYXN0Lm1ha2VUZXh0KFwi4Lih4Li14LiK4LmI4Lit4LiH4Lin4LmI4Liy4LiH4LiZ4Liw4LmE4Lit4LmJ4LmC4LiH4LmIXCIpO1xyXG4gICAgICAgICAgICB0b2FzdC5zaG93KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuXHJcblxyXG59XHJcbiJdfQ==