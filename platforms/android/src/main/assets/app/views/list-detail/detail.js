"use strict";
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var observable_1 = require("data/observable");
var fs = require("file-system"); //เรียกใช้เพื่อเข้าถึง uri
var dialogs = require("ui/dialogs");
var Sqlite = require("nativescript-sqlite");
var http = require("http");
var sound = require("nativescript-sound"); //เรียกใช้ plugin sound
var ListDetailComponent = (function (_super) {
    __extends(ListDetailComponent, _super);
    function ListDetailComponent(route) {
        var _this = _super.call(this) || this;
        _this.route = route;
        _this.url = "http://translate.google.com/translate_tts?ie=UTF-8&tl=en&client=tw-ob&q="; // link สำหรับ load ไฟล์จาก google traslate
        var self = _this;
        _this.route.queryParams.subscribe(function (params) {
            console.log(JSON.stringify(params));
            self.word = JSON.parse(params["words"]); // ให้ตัวแปร self.word รับค่าจาก list main ด้วยรูป json โดยส่งมาในชื่อ words ด้วยคำสั่ง params["words"]
            console.log(self.word.id);
            console.log(self.word.dict_search);
            console.log(self.word.dict_meaning);
            /*let temp = self.word.wordType;
            self.word.wordType = self.changWordType(temp);
            console.log(self.word.wordType);*/
            self.url = self.url + self.word.dict_search; //set word สำหรับค้นหา googletraslate
            self.setButtonSound(self.url);
            //เรียกเปิดใช้ Databasee
            new Sqlite("dicts.db").then(function (db) {
                self.database = db;
                console.log("Open database Success");
            }, function (error) {
                console.log("Open DB ERROR", error);
            });
        });
        return _this;
    }
    ListDetailComponent.prototype.ngOnInit = function () {
        var self = this;
        var word_id = self.word.id;
        self.myHistory();
        self.database.all("SELECT * FROM FAVORITE WHERE dict_no = (?)", [word_id]).then(function (rows) {
            if (rows == "") {
                self.favorite = 0;
            }
            else {
                self.favorite = 1;
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    ListDetailComponent.prototype.myFavorite = function () {
        console.log("click Favorite");
        var self = this;
        var word_id = self.word.id;
        self.myCheckFavorite(word_id);
        /*
        if(self.favorite == 0 ){
            self.favorite = 1;
            self.database.execSQL("UPDATE dict SET favorite = (?) WHERE id = (?) " ,[self.favorite , self.word.id] , function(err , db ){
            if(err){
                console.log("error is == > " , err);
            }else{
                console.log("Update Success");
                
            }
        });

        }else if(self.favorite == 1){
            self.favorite = 0 ;
            self.database.execSQL("UPDATE dict SET favorite = (?) WHERE id = (?)" ,[self.favorite , self.word.id] , function(err , db ){
                if(err){
                    console.log("error is == > " , err);
                }else{
                    console.log("Update Success");
                
                }
            });
        }*/
    };
    ListDetailComponent.prototype.myCheckFavorite = function (word_id) {
        var self = this;
        self.database.all("SELECT * FROM FAVORITE WHERE dict_no = (?)", [word_id]).then(function (rows) {
            if (rows == "") {
                self.myInsertFavorite(word_id);
            }
            else {
                self.myDeleteFavoite(word_id);
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    ListDetailComponent.prototype.myInsertFavorite = function (word_id) {
        var self = this;
        self.database.execSQL("INSERT INTO FAVORITE (dict_no) VALUES (?)", [word_id]).then(function (word_insert) {
            console.log("INSERT RESULT => ", word_insert);
            self.favorite = 1;
        }, function (error) {
            console.log("INSERT ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.myDeleteFavoite = function (word_id) {
        var self = this;
        self.database.execSQL("DELETE FROM FAVORITE WHERE dict_no = (?)", [word_id]).then(function (word_delete) {
            console.log("DELETE RESULT => ", word_delete);
            self.favorite = 0;
        }, function (error) {
            console.log("DELETE ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.myHistory = function () {
        var self = this;
        var word_id = self.word.id;
        self.myCheckHistory(word_id);
    };
    ListDetailComponent.prototype.myCheckHistory = function (word_id) {
        var self = this;
        self.database.all("SELECT * FROM HISTORY WHERE dict_no = (?)", [word_id]).then(function (rows) {
            if (rows == "") {
                self.myInsertHistory(word_id);
            }
            else {
                self.myDeleteHistory(word_id);
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    ListDetailComponent.prototype.myDeleteHistory = function (word_id) {
        var self = this;
        self.database.execSQL("DELETE FROM HISTORY WHERE dict_no = (?)", [word_id]).then(function (word_delete) {
            console.log("DELETE RESULT => ", word_delete);
            self.myInsertHistory(word_id);
        }, function (error) {
            console.log("DELETE ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.myInsertHistory = function (word_id) {
        var self = this;
        self.database.execSQL("INSERT INTO HISTORY (dict_no,dict_search) VALUES (?,?)", [word_id, self.word.dict_search]).then(function (word_insert) {
            console.log("INSERT RESULT => ", word_insert);
        }, function (error) {
            console.log("INSERT ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.fetchJoin = function () {
        var self = this;
        console.log("go to fetch Join ");
        self.database.all("SELECT h.id, h.word_id , d.engWorld , d.thaiWorld , d.type FROM dict d join HISTORY h on d.id = h.word_id ORDER BY h.id DESC").then(function (rows) {
            for (var row in rows) {
                console.log("Result ==v");
                /*for(var i=0 ; i <= rows.length ; i++ ){
                    console.log("result ==>" , rows[row][i]);
                }*/
                console.log("result all ==> ", rows[row]); //result all
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    ListDetailComponent.prototype.changWordType = function (arg) {
        console.log("changWordType == v");
        var word = arg;
        var wordIndexOf = word.indexOf("[");
        var wordLastIndexOf = word.lastIndexOf("]");
        console.log("word arg === > ", word);
        console.log("index of ===== > ", wordIndexOf);
        console.log("last Indexof ===== > ", wordLastIndexOf);
        if (wordIndexOf == 1 && wordLastIndexOf != -1) {
            console.log(" true v");
            return word;
        }
        else {
            console.log(" else v ");
            word = "[" + word + "]";
            return word;
        }
    };
    ListDetailComponent.prototype.sound_play = function () {
        console.log("Click Sound");
        var self = this;
        self.play_word.play();
    };
    ListDetailComponent.prototype.setButtonSound = function (arg) {
        console.log("Set button Sound");
        var self = this;
        var word = arg;
        var documents = fs.knownFolders.documents();
        var my_path = documents.getFolder("mySound");
        var filePath = fs.path.join(my_path.path, "sound.mp3");
        http.getFile({ url: self.url,
            method: "GET",
            headers: {
                "Referer": 'http://translate.google.com/',
                "User-Agent": 'stagefright/1.2 (Linux;Android 5.0)',
                "Content-Type": 'audio/mpeg'
            }
        }, filePath).then(function (r) {
            //// Argument (response) is HttpResponse!
            console.log(JSON.stringify(r.path));
            self.play_word = sound.create(r.path);
        }, function (e) {
            console.log("error => ", e);
        });
    };
    return ListDetailComponent;
}(observable_1.Observable));
ListDetailComponent = __decorate([
    core_1.Component({
        selector: "ns-app",
        templateUrl: "views/list-detail/detail.html",
    }),
    __metadata("design:paramtypes", [router_1.ActivatedRoute])
], ListDetailComponent);
exports.ListDetailComponent = ListDetailComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0YWlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV0YWlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxzQ0FBa0Q7QUFHbEQsMENBQWlEO0FBR2pELDhDQUE2QztBQUM3QyxnQ0FBa0MsQ0FBRSwwQkFBMEI7QUFFOUQsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3BDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVDLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMzQixJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLHVCQUF1QjtBQU9sRSxJQUFhLG1CQUFtQjtJQUFTLHVDQUFVO0lBVTlDLDZCQUEyQixLQUFxQjtRQUFoRCxZQUNHLGlCQUFPLFNBOEJWO1FBL0IyQixXQUFLLEdBQUwsS0FBSyxDQUFnQjtRQUx6QyxTQUFHLEdBQUcsMEVBQTBFLENBQUMsQ0FBQSwyQ0FBMkM7UUFRaEksSUFBSSxJQUFJLEdBQUcsS0FBSSxDQUFDO1FBQ2hCLEtBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxVQUFBLE1BQU07WUFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFFLENBQUM7WUFDckMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsdUdBQXVHO1lBRWhKLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMxQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDbkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFB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QUFJLENBQUMsVUFBVSxDQUFDO1lBQ2hDLHlDQUF5QztZQUN6QyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDcEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxQyxDQUFDLEVBQUUsVUFBVSxDQUFDO1lBQ1YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUcsQ0FBQyxDQUFDLENBQUM7UUFFakMsQ0FBQyxDQUFDLENBQUM7SUFLUCxDQUFDO0lBS0osMEJBQUM7QUFBRCxDQUFDLEFBM1FGLENBQXlDLHVCQUFVLEdBMlFqRDtBQTNRVyxtQkFBbUI7SUFKL0IsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxRQUFRO1FBQ2xCLFdBQVcsRUFBRSwrQkFBK0I7S0FDL0MsQ0FBQztxQ0FXcUMsdUJBQWM7R0FWeEMsbUJBQW1CLENBMlE5QjtBQTNRVyxrREFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFBhZ2VSb3V0ZSB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjsgXHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcclxuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUgfSBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyXCI7XHJcbmltcG9ydCB7IEl0ZW0gfSBmcm9tIFwiLi4vLi4vbW9kZWxzL2l0ZW1zL2l0ZW1cIjtcclxuaW1wb3J0IHsgV29yZEl0ZW0gfSBmcm9tIFwiLi4vLi4vbW9kZWxzL2l0ZW1zL2l0ZW1zX3dvcmRcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ2RhdGEvb2JzZXJ2YWJsZSc7XHJcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmaWxlLXN5c3RlbVwiOyAgLy/guYDguKPguLXguKLguIHguYPguIrguYnguYDguJ7guLfguYjguK3guYDguILguYnguLLguJbguLbguIcgdXJpXHJcblxyXG52YXIgZGlhbG9ncyA9IHJlcXVpcmUoXCJ1aS9kaWFsb2dzXCIpO1xyXG52YXIgU3FsaXRlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1zcWxpdGVcIik7XHJcbnZhciBodHRwID0gcmVxdWlyZShcImh0dHBcIik7XHJcbnZhciBzb3VuZCA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtc291bmRcIik7IC8v4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJIHBsdWdpbiBzb3VuZFxyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwibnMtYXBwXCIsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9saXN0LWRldGFpbC9kZXRhaWwuaHRtbFwiLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgTGlzdERldGFpbENvbXBvbmVudCBleHRlbmRzIE9ic2VydmFibGUgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gXHJcbiAgICB3b3JkOldvcmRJdGVtOyAgICAgIC8vd29yZCDguJfguLXguYjguYTguJTguYnguKPguLHguJrguYDguILguYnguLLguKHguLLguIjguLLguIEgbHNpdCBtYWluXHJcbiAgICBmYXZvcml0ZSA6IGFueSA7ICAgIC8vIGJ1dHRvbiBvdXRwdXQgc2hvdyBvbiBsYXlvdXRcclxuXHJcbiAgICBwcml2YXRlIHVybCA9IFwiaHR0cDovL3RyYW5zbGF0ZS5nb29nbGUuY29tL3RyYW5zbGF0ZV90dHM/aWU9VVRGLTgmdGw9ZW4mY2xpZW50PXR3LW9iJnE9XCI7Ly8gbGluayDguKrguLPguKvguKPguLHguJogbG9hZCDguYTguJ/guKXguYzguIjguLLguIEgZ29vZ2xlIHRyYXNsYXRlXHJcbiAgICBwcml2YXRlIGRhdGFiYXNlOyAvLyDguJXguLHguKfguYHguJvguKMgRGF0YWJhc2VcclxuICAgIHByaXZhdGUgcGxheV93b3JkOyAvLyDguYDguKXguYjguJnguYDguKrguLXguKLguIcgd29yZFxyXG5cclxuXHJcbiAgICAgcHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucm91dGUucXVlcnlQYXJhbXMuc3Vic2NyaWJlKHBhcmFtcyA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocGFyYW1zKSApO1xyXG4gICAgICAgIHNlbGYud29yZCA9IEpTT04ucGFyc2UocGFyYW1zW1wid29yZHNcIl0pOyAvLyDguYPguKvguYnguJXguLHguKfguYHguJvguKMgc2VsZi53b3JkIOC4o+C4seC4muC4hOC5iOC4suC4iOC4suC4gSBsaXN0IG1haW4g4LiU4LmJ4Lin4Lii4Lij4Li54LibIGpzb24g4LmC4LiU4Lii4Liq4LmI4LiH4Lih4Liy4LmD4LiZ4LiK4Li34LmI4LitIHdvcmRzIOC4lOC5ieC4p+C4ouC4hOC4s+C4quC4seC5iOC4hyBwYXJhbXNbXCJ3b3Jkc1wiXVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhzZWxmLndvcmQuaWQpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGYud29yZC5kaWN0X3NlYXJjaCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coc2VsZi53b3JkLmRpY3RfbWVhbmluZyk7XHJcbiAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLypsZXQgdGVtcCA9IHNlbGYud29yZC53b3JkVHlwZTtcclxuICAgICAgICBzZWxmLndvcmQud29yZFR5cGUgPSBzZWxmLmNoYW5nV29yZFR5cGUodGVtcCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coc2VsZi53b3JkLndvcmRUeXBlKTsqL1xyXG5cclxuICAgICAgICBzZWxmLnVybCA9IHNlbGYudXJsICsgc2VsZi53b3JkLmRpY3Rfc2VhcmNoOy8vc2V0IHdvcmQg4Liq4Liz4Lir4Lij4Lix4Lia4LiE4LmJ4LiZ4Lir4LiyIGdvb2dsZXRyYXNsYXRlXHJcbiAgICAgICAgc2VsZi5zZXRCdXR0b25Tb3VuZChzZWxmLnVybCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy/guYDguKPguLXguKLguIHguYDguJvguLTguJTguYPguIrguYkgRGF0YWJhc2VlXHJcbiAgICAgICAgbmV3IFNxbGl0ZShcImRpY3RzLmRiXCIpLnRoZW4oZGIgPT57XHJcbiAgICAgICAgICAgIHNlbGYuZGF0YWJhc2UgPSBkYjtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJPcGVuIGRhdGFiYXNlIFN1Y2Nlc3NcIik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0sZXJyb3IgPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiT3BlbiBEQiBFUlJPUlwiICwgZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGxldCB3b3JkX2lkID0gc2VsZi53b3JkLmlkO1xyXG4gICAgICAgIHNlbGYubXlIaXN0b3J5KCk7XHJcbiAgICAgICAgc2VsZi5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgKiBGUk9NIEZBVk9SSVRFIFdIRVJFIGRpY3Rfbm8gPSAoPylcIixbd29yZF9pZF0pLnRoZW4ocm93cyA9PntcclxuICAgICAgICAgICAgaWYocm93cyA9PVwiXCIpe1xyXG4gICAgICAgICAgICAgICAgc2VsZi5mYXZvcml0ZSA9IDA7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgc2VsZi5mYXZvcml0ZSA9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LGVycm9yID0+e1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNFTEVDVCBFUlJPUiBcIiAsIGVycm9yKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBteUZhdm9yaXRlKCl7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJjbGljayBGYXZvcml0ZVwiKTtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgbGV0IHdvcmRfaWQgPSBzZWxmLndvcmQuaWQ7XHJcblxyXG4gICAgICAgIHNlbGYubXlDaGVja0Zhdm9yaXRlKHdvcmRfaWQpO1xyXG4gICAgICAgIC8qXHJcbiAgICAgICAgaWYoc2VsZi5mYXZvcml0ZSA9PSAwICl7XHJcbiAgICAgICAgICAgIHNlbGYuZmF2b3JpdGUgPSAxO1xyXG4gICAgICAgICAgICBzZWxmLmRhdGFiYXNlLmV4ZWNTUUwoXCJVUERBVEUgZGljdCBTRVQgZmF2b3JpdGUgPSAoPykgV0hFUkUgaWQgPSAoPykgXCIgLFtzZWxmLmZhdm9yaXRlICwgc2VsZi53b3JkLmlkXSAsIGZ1bmN0aW9uKGVyciAsIGRiICl7XHJcbiAgICAgICAgICAgIGlmKGVycil7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIGlzID09ID4gXCIgLCBlcnIpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXBkYXRlIFN1Y2Nlc3NcIik7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9ZWxzZSBpZihzZWxmLmZhdm9yaXRlID09IDEpe1xyXG4gICAgICAgICAgICBzZWxmLmZhdm9yaXRlID0gMCA7XHJcbiAgICAgICAgICAgIHNlbGYuZGF0YWJhc2UuZXhlY1NRTChcIlVQREFURSBkaWN0IFNFVCBmYXZvcml0ZSA9ICg/KSBXSEVSRSBpZCA9ICg/KVwiICxbc2VsZi5mYXZvcml0ZSAsIHNlbGYud29yZC5pZF0gLCBmdW5jdGlvbihlcnIgLCBkYiApe1xyXG4gICAgICAgICAgICAgICAgaWYoZXJyKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIGlzID09ID4gXCIgLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGUgU3VjY2Vzc1wiKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgICBwcml2YXRlIG15Q2hlY2tGYXZvcml0ZSh3b3JkX2lkKXtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgKiBGUk9NIEZBVk9SSVRFIFdIRVJFIGRpY3Rfbm8gPSAoPylcIixbd29yZF9pZF0pLnRoZW4ocm93cyA9PntcclxuICAgICAgICAgICAgaWYocm93cyA9PVwiXCIpe1xyXG4gICAgICAgICAgICAgICAgc2VsZi5teUluc2VydEZhdm9yaXRlKHdvcmRfaWQpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHNlbGYubXlEZWxldGVGYXZvaXRlKHdvcmRfaWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxlcnJvciA9PntcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTRUxFQ1QgRVJST1IgXCIgLCBlcnJvcik7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG15SW5zZXJ0RmF2b3JpdGUod29yZF9pZCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYuZGF0YWJhc2UuZXhlY1NRTChcIklOU0VSVCBJTlRPIEZBVk9SSVRFIChkaWN0X25vKSBWQUxVRVMgKD8pXCIsIFt3b3JkX2lkXSkudGhlbih3b3JkX2luc2VydCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIklOU0VSVCBSRVNVTFQgPT4gXCIgLCB3b3JkX2luc2VydCAgKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuZmF2b3JpdGUgPTE7XHJcbiAgICAgICAgICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgRVJST1IgPT4gXCIgLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBteURlbGV0ZUZhdm9pdGUod29yZF9pZCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYuZGF0YWJhc2UuZXhlY1NRTChcIkRFTEVURSBGUk9NIEZBVk9SSVRFIFdIRVJFIGRpY3Rfbm8gPSAoPylcIiwgW3dvcmRfaWRdKS50aGVuKHdvcmRfZGVsZXRlID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJERUxFVEUgUkVTVUxUID0+IFwiICwgd29yZF9kZWxldGUgICk7XHJcbiAgICAgICAgICAgIHNlbGYuZmF2b3JpdGUgPSAwO1xyXG4gICAgICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRFTEVURSBFUlJPUiA9PiBcIiAsIGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgbXlIaXN0b3J5KCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGxldCB3b3JkX2lkID0gc2VsZi53b3JkLmlkO1xyXG4gICAgICAgIHNlbGYubXlDaGVja0hpc3Rvcnkod29yZF9pZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbXlDaGVja0hpc3Rvcnkod29yZF9pZCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLmRhdGFiYXNlLmFsbChcIlNFTEVDVCAqIEZST00gSElTVE9SWSBXSEVSRSBkaWN0X25vID0gKD8pXCIsW3dvcmRfaWRdKS50aGVuKHJvd3MgPT57XHJcbiAgICAgICAgICAgIGlmKHJvd3MgPT1cIlwiKXtcclxuICAgICAgICAgICAgICAgIHNlbGYubXlJbnNlcnRIaXN0b3J5KHdvcmRfaWQpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHNlbGYubXlEZWxldGVIaXN0b3J5KHdvcmRfaWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxlcnJvciA9PntcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTRUxFQ1QgRVJST1IgXCIgLCBlcnJvcik7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG15RGVsZXRlSGlzdG9yeSh3b3JkX2lkKXtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYuZGF0YWJhc2UuZXhlY1NRTChcIkRFTEVURSBGUk9NIEhJU1RPUlkgV0hFUkUgZGljdF9ubyA9ICg/KVwiLCBbd29yZF9pZF0pLnRoZW4od29yZF9kZWxldGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRFTEVURSBSRVNVTFQgPT4gXCIgLCB3b3JkX2RlbGV0ZSAgKTtcclxuICAgICAgICAgICAgc2VsZi5teUluc2VydEhpc3Rvcnkod29yZF9pZCk7XHJcbiAgICAgICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiREVMRVRFIEVSUk9SID0+IFwiICwgZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG15SW5zZXJ0SGlzdG9yeSh3b3JkX2lkKXtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi5kYXRhYmFzZS5leGVjU1FMKFwiSU5TRVJUIElOVE8gSElTVE9SWSAoZGljdF9ubyxkaWN0X3NlYXJjaCkgVkFMVUVTICg/LD8pXCIsIFt3b3JkX2lkLHNlbGYud29yZC5kaWN0X3NlYXJjaF0pLnRoZW4od29yZF9pbnNlcnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgUkVTVUxUID0+IFwiICwgd29yZF9pbnNlcnQgICk7XHJcbiAgICAgICAgICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgRVJST1IgPT4gXCIgLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmZXRjaEpvaW4oKXtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJnbyB0byBmZXRjaCBKb2luIFwiKTtcclxuXHJcbiAgICAgICAgc2VsZi5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgaC5pZCwgaC53b3JkX2lkICwgZC5lbmdXb3JsZCAsIGQudGhhaVdvcmxkICwgZC50eXBlIEZST00gZGljdCBkIGpvaW4gSElTVE9SWSBoIG9uIGQuaWQgPSBoLndvcmRfaWQgT1JERVIgQlkgaC5pZCBERVNDXCIpLnRoZW4ocm93cyA9PntcclxuICAgICAgICAgICAgZm9yKHZhciByb3cgaW4gcm93cyl7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlc3VsdCA9PXZcIik7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8qZm9yKHZhciBpPTAgOyBpIDw9IHJvd3MubGVuZ3RoIDsgaSsrICl7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZXN1bHQgPT0+XCIgLCByb3dzW3Jvd11baV0pOyBcclxuICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZXN1bHQgYWxsID09PiBcIiAsIHJvd3Nbcm93XSk7Ly9yZXN1bHQgYWxsXHJcbiAgICAgICAgICAgICAgICAvKmNvbnNvbGUubG9nKFwiaWRfSGlzdG9yeSA9PT4gXCIgLCByb3dzW3Jvd11bMF0pOyAvLyByZXN1bHQgZW5nXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIndvcmRfaWQgPT0+IFwiICwgcm93c1tyb3ddWzFdKTsgLy8gcmVzdWx0IGVuZ1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlbmdfd29yZCA9PT4gXCIgLCByb3dzW3Jvd11bMl0pOyAvLyByZXN1bHQgZW5nXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInRoYWlfd29yZCA9PT4gXCIgLCByb3dzW3Jvd11bM10pOyAvL3Jlc3VsdCB0aGFpXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIndvcmRfdHlwZSA9PT4gXCIgLCByb3dzW3Jvd11bNF0pOyAvL3Jlc3VsdCB0aGFpKi9cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sZXJyb3IgPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU0VMRUNUIEVSUk9SIFwiICwgZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hhbmdXb3JkVHlwZShhcmcpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiY2hhbmdXb3JkVHlwZSA9PSB2XCIpO1xyXG4gICAgICAgIGxldCB3b3JkID0gYXJnO1xyXG5cclxuICAgICAgICBsZXQgd29yZEluZGV4T2YgPSB3b3JkLmluZGV4T2YoXCJbXCIpO1xyXG4gICAgICAgIGxldCB3b3JkTGFzdEluZGV4T2YgPSB3b3JkLmxhc3RJbmRleE9mKFwiXVwiKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIndvcmQgYXJnID09PSA+IFwiICwgd29yZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc29sZS5sb2coXCJpbmRleCBvZiA9PT09PSA+IFwiICwgd29yZEluZGV4T2YpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwibGFzdCBJbmRleG9mID09PT09ID4gXCIgLCB3b3JkTGFzdEluZGV4T2YpO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBpZih3b3JkSW5kZXhPZiA9PSAxICYmIHdvcmRMYXN0SW5kZXhPZiAhPSAtMSl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIHRydWUgdlwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIHdvcmQ7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIGVsc2UgdiBcIik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB3b3JkID0gXCJbXCIgKyB3b3JkICsgXCJdXCI7XHJcbiAgICAgICAgICAgIHJldHVybiB3b3JkO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzb3VuZF9wbGF5KCl7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJDbGljayBTb3VuZFwiKTtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi5wbGF5X3dvcmQucGxheSgpO1xyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRCdXR0b25Tb3VuZChhcmcpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiU2V0IGJ1dHRvbiBTb3VuZFwiKTtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgbGV0IHdvcmQgPSBhcmc7XHJcblxyXG4gICAgICAgIGxldCBkb2N1bWVudHMgPSBmcy5rbm93bkZvbGRlcnMuZG9jdW1lbnRzKCk7XHJcbiAgICAgICAgbGV0IG15X3BhdGggPSBkb2N1bWVudHMuZ2V0Rm9sZGVyKFwibXlTb3VuZFwiKTtcclxuICAgICAgICB2YXIgZmlsZVBhdGggPSBmcy5wYXRoLmpvaW4obXlfcGF0aC5wYXRoLCBcInNvdW5kLm1wM1wiKTtcclxuXHJcbiAgICAgICAgaHR0cC5nZXRGaWxlKHsgdXJsOiBzZWxmLnVybCxcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlJlZmVyZXJcIiA6ICdodHRwOi8vdHJhbnNsYXRlLmdvb2dsZS5jb20vJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJVc2VyLUFnZW50XCIgOiAnc3RhZ2VmcmlnaHQvMS4yIChMaW51eDtBbmRyb2lkIDUuMCknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiAnYXVkaW8vbXBlZydcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sZmlsZVBhdGgpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgLy8vLyBBcmd1bWVudCAocmVzcG9uc2UpIGlzIEh0dHBSZXNwb25zZSFcclxuICAgICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoci5wYXRoKSk7XHJcbiAgICAgICAgICAgIHNlbGYucGxheV93b3JkID0gc291bmQuY3JlYXRlKHIucGF0aCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciA9PiBcIiAsIGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgIFxyXG5cdCAgXHJcbiAgICBcclxuIH1cclxuIl19