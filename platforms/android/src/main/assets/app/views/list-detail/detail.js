"use strict";
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var dialogs = require("ui/dialogs");
var Sqlite = require("nativescript-sqlite");
var ListDetailComponent = (function () {
    function ListDetailComponent(route) {
        var _this = this;
        this.route = route;
        var self = this;
        this.route.queryParams.subscribe(function (params) {
            console.log(JSON.stringify(params));
            self.word = JSON.parse(params["words"]); // ให้ตัวแปร self.word รับค่าจาก list main ด้วยรูป json โดยส่งมาในชื่อ words ด้วยคำสั่ง params["words"]
            console.log(self.word.id);
            console.log(self.word.wordEng);
            console.log(self.word.wordThai);
            console.log(self.word.wordType);
            console.log(self.word.wordFavorite);
            self.favorite = self.word.wordFavorite; // ให้ favorite
            var temp = self.word.wordType;
            self.word.wordType = self.changWordType(temp);
            console.log(self.word.wordType);
            new Sqlite("dicts.db").then(function (db) {
                _this.database = db;
                console.log("Open database Success");
            }, function (error) {
                console.log("Open DB ERROR", error);
            });
        });
    }
    ListDetailComponent.prototype.ngOnInit = function () {
        var self = this;
        self.myHistory();
    };
    ListDetailComponent.prototype.myFavorite = function () {
        console.log("click Favorite");
        var self = this;
        if (self.favorite == 0) {
            self.favorite = 1;
            self.database.execSQL("UPDATE dict SET favorite = (?) WHERE id = (?) ", [self.favorite, self.word.id], function (err, db) {
                if (err) {
                    console.log("error is == > ", err);
                }
                else {
                    console.log("Update Success");
                }
            });
        }
        else if (self.favorite == 1) {
            self.favorite = 0;
            self.database.execSQL("UPDATE dict SET favorite = (?) WHERE id = (?)", [self.favorite, self.word.id], function (err, db) {
                if (err) {
                    console.log("error is == > ", err);
                }
                else {
                    console.log("Update Success");
                }
            });
        }
    };
    ListDetailComponent.prototype.myHistory = function () {
        var self = this;
        var word_id = self.word.id;
        self.myCheckHistory(word_id);
    };
    ListDetailComponent.prototype.myCheckHistory = function (word_id) {
        var self = this;
        self.database.all("SELECT * FROM HISTORY WHERE word_id = (?)", [word_id]).then(function (rows) {
            if (rows == "") {
                self.myInsertHistory(word_id);
            }
            else {
                self.myDeleteHistory(word_id);
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    ListDetailComponent.prototype.myDeleteHistory = function (word_id) {
        var self = this;
        self.database.execSQL("DELETE FROM HISTORY WHERE word_id = (?)", [word_id]).then(function (word_delete) {
            console.log("DELETE RESULT => ", word_delete);
            self.myInsertHistory(word_id);
        }, function (error) {
            console.log("DELETE ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.myInsertHistory = function (word_id) {
        var self = this;
        self.database.execSQL("INSERT INTO HISTORY (word_id) VALUES (?)", [word_id]).then(function (word_insert) {
            console.log("INSERT RESULT => ", word_insert);
        }, function (error) {
            console.log("INSERT ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.fetchJoin = function () {
        var self = this;
        console.log("go to fetch Join ");
        self.database.all("SELECT h.id, h.word_id , d.engWorld , d.thaiWorld , d.type FROM dict d join HISTORY h on d.id = h.word_id ORDER BY h.id DESC").then(function (rows) {
            for (var row in rows) {
                console.log("Result ==v");
                /*for(var i=0 ; i <= rows.length ; i++ ){
                    console.log("result ==>" , rows[row][i]);
                }*/
                console.log("result all ==> ", rows[row]); //result all
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    ListDetailComponent.prototype.changWordType = function (arg) {
        console.log("changWordType == v");
        var word = arg;
        var wordIndexOf = word.indexOf("[");
        var wordLastIndexOf = word.lastIndexOf("]");
        console.log("word arg === > ", word);
        console.log("index of ===== > ", wordIndexOf);
        console.log("last Indexof ===== > ", wordLastIndexOf);
        if (wordIndexOf == 1 && wordLastIndexOf != -1) {
            console.log(" true v");
            return word;
        }
        else {
            console.log(" else v ");
            word = "[" + word + "]";
            return word;
        }
    };
    return ListDetailComponent;
}());
ListDetailComponent = __decorate([
    core_1.Component({
        selector: "ns-app",
        templateUrl: "views/list-detail/detail.html",
    }),
    __metadata("design:paramtypes", [router_1.ActivatedRoute])
], ListDetailComponent);
exports.ListDetailComponent = ListDetailComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0YWlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV0YWlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxzQ0FBa0Q7QUFHbEQsMENBQWlEO0FBR2pELElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUNwQyxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQU01QyxJQUFhLG1CQUFtQjtJQVMzQiw2QkFBMkIsS0FBcUI7UUFBaEQsaUJBa0NBO1FBbEMyQixVQUFLLEdBQUwsS0FBSyxDQUFnQjtRQUU3QyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFHaEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLFVBQUEsTUFBTTtZQUN2QyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUUsQ0FBQztZQUNyQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyx1R0FBdUc7WUFFaEosT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzFCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMvQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDaEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUVwQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMs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QUFHLGVBQWUsQ0FBQyxDQUFDO1FBR3ZELEVBQUUsQ0FBQSxDQUFDLFdBQVcsSUFBSSxDQUFDLElBQUksZUFBZSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQztZQUMxQyxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDaEIsQ0FBQztRQUFBLElBQUksQ0FBQSxDQUFDO1lBQ0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUV4QixJQUFJLEdBQUcsR0FBRyxHQUFHLElBQUksR0FBRyxHQUFHLENBQUM7WUFDeEIsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNoQixDQUFDO0lBRUwsQ0FBQztJQUtKLDBCQUFDO0FBQUQsQ0FBQyxBQXhMRixJQXdMRTtBQXhMVyxtQkFBbUI7SUFKL0IsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxRQUFRO1FBQ2xCLFdBQVcsRUFBRSwrQkFBK0I7S0FDL0MsQ0FBQztxQ0FVcUMsdUJBQWM7R0FUeEMsbUJBQW1CLENBd0w5QjtBQXhMVyxrREFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFBhZ2VSb3V0ZSB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjsgXHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcclxuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUgfSBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyXCI7XHJcbmltcG9ydCB7IEl0ZW0gfSBmcm9tIFwiLi4vLi4vbW9kZWxzL2l0ZW1zL2l0ZW1cIjtcclxuXHJcbnZhciBkaWFsb2dzID0gcmVxdWlyZShcInVpL2RpYWxvZ3NcIik7XHJcbnZhciBTcWxpdGUgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXNxbGl0ZVwiKTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwibnMtYXBwXCIsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9saXN0LWRldGFpbC9kZXRhaWwuaHRtbFwiLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgTGlzdERldGFpbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiBcclxuICAgIHdvcmQ6SXRlbTsgICAgICAvL3dvcmQg4LiX4Li14LmI4LmE4LiU4LmJ4Lij4Lix4Lia4LmA4LiC4LmJ4Liy4Lih4Liy4LiI4Liy4LiBIGxzaXQgbWFpblxyXG4gICAgZmF2b3JpdGUgOiBhbnkgOyAgICAvLyBidXR0b24gb3V0cHV0IHNob3cgb24gbGF5b3V0XHJcblxyXG5cclxuXHJcbiAgICBwcml2YXRlIGRhdGFiYXNlOyAvLyDguJXguLHguKfguYHguJvguKMgRGF0YWJhc2VcclxuXHJcbiAgICAgcHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlKSB7XHJcblxyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuXHJcblxyXG4gICAgICAgIHRoaXMucm91dGUucXVlcnlQYXJhbXMuc3Vic2NyaWJlKHBhcmFtcyA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocGFyYW1zKSApO1xyXG4gICAgICAgIHNlbGYud29yZCA9IEpTT04ucGFyc2UocGFyYW1zW1wid29yZHNcIl0pOyAvLyDguYPguKvguYnguJXguLHguKfguYHguJvguKMgc2VsZi53b3JkIOC4o+C4seC4muC4hOC5iOC4suC4iOC4suC4gSBsaXN0IG1haW4g4LiU4LmJ4Lin4Lii4Lij4Li54LibIGpzb24g4LmC4LiU4Lii4Liq4LmI4LiH4Lih4Liy4LmD4LiZ4LiK4Li34LmI4LitIHdvcmRzIOC4lOC5ieC4p+C4ouC4hOC4s+C4quC4seC5iOC4hyBwYXJhbXNbXCJ3b3Jkc1wiXVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhzZWxmLndvcmQuaWQpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGYud29yZC53b3JkRW5nKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhzZWxmLndvcmQud29yZFRoYWkpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGYud29yZC53b3JkVHlwZSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coc2VsZi53b3JkLndvcmRGYXZvcml0ZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc2VsZi5mYXZvcml0ZSA9IHNlbGYud29yZC53b3JkRmF2b3JpdGU7IC8vIOC5g+C4q+C5iSBmYXZvcml0ZVxyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCB0ZW1wID0gc2VsZi53b3JkLndvcmRUeXBlO1xyXG4gICAgICAgIHNlbGYud29yZC53b3JkVHlwZSA9IHNlbGYuY2hhbmdXb3JkVHlwZSh0ZW1wKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhzZWxmLndvcmQud29yZFR5cGUpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG5cclxuXHJcbiAgICAgICAgbmV3IFNxbGl0ZShcImRpY3RzLmRiXCIpLnRoZW4oZGIgPT57XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YWJhc2UgPSBkYjtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJPcGVuIGRhdGFiYXNlIFN1Y2Nlc3NcIik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0sZXJyb3IgPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiT3BlbiBEQiBFUlJPUlwiICwgZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYubXlIaXN0b3J5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbXlGYXZvcml0ZSgpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiY2xpY2sgRmF2b3JpdGVcIik7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGlmKHNlbGYuZmF2b3JpdGUgPT0gMCApe1xyXG4gICAgICAgICAgICBzZWxmLmZhdm9yaXRlID0gMTtcclxuICAgICAgICAgICAgc2VsZi5kYXRhYmFzZS5leGVjU1FMKFwiVVBEQVRFIGRpY3QgU0VUIGZhdm9yaXRlID0gKD8pIFdIRVJFIGlkID0gKD8pIFwiICxbc2VsZi5mYXZvcml0ZSAsIHNlbGYud29yZC5pZF0gLCBmdW5jdGlvbihlcnIgLCBkYiApe1xyXG4gICAgICAgICAgICBpZihlcnIpe1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciBpcyA9PSA+IFwiICwgZXJyKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVwZGF0ZSBTdWNjZXNzXCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfWVsc2UgaWYoc2VsZi5mYXZvcml0ZSA9PSAxKXtcclxuICAgICAgICAgICAgc2VsZi5mYXZvcml0ZSA9IDAgO1xyXG4gICAgICAgICAgICBzZWxmLmRhdGFiYXNlLmV4ZWNTUUwoXCJVUERBVEUgZGljdCBTRVQgZmF2b3JpdGUgPSAoPykgV0hFUkUgaWQgPSAoPylcIiAsW3NlbGYuZmF2b3JpdGUgLCBzZWxmLndvcmQuaWRdICwgZnVuY3Rpb24oZXJyICwgZGIgKXtcclxuICAgICAgICAgICAgICAgIGlmKGVycil7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciBpcyA9PSA+IFwiICwgZXJyKTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXBkYXRlIFN1Y2Nlc3NcIik7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbXlIaXN0b3J5KCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGxldCB3b3JkX2lkID0gc2VsZi53b3JkLmlkO1xyXG4gICAgICAgIHNlbGYubXlDaGVja0hpc3Rvcnkod29yZF9pZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbXlDaGVja0hpc3Rvcnkod29yZF9pZCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLmRhdGFiYXNlLmFsbChcIlNFTEVDVCAqIEZST00gSElTVE9SWSBXSEVSRSB3b3JkX2lkID0gKD8pXCIsW3dvcmRfaWRdKS50aGVuKHJvd3MgPT57XHJcbiAgICAgICAgICAgIGlmKHJvd3MgPT1cIlwiKXtcclxuICAgICAgICAgICAgICAgIHNlbGYubXlJbnNlcnRIaXN0b3J5KHdvcmRfaWQpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHNlbGYubXlEZWxldGVIaXN0b3J5KHdvcmRfaWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxlcnJvciA9PntcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTRUxFQ1QgRVJST1IgXCIgLCBlcnJvcik7XHJcbiAgICAgICAgfSlcclxuXHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG15RGVsZXRlSGlzdG9yeSh3b3JkX2lkKXtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYuZGF0YWJhc2UuZXhlY1NRTChcIkRFTEVURSBGUk9NIEhJU1RPUlkgV0hFUkUgd29yZF9pZCA9ICg/KVwiLCBbd29yZF9pZF0pLnRoZW4od29yZF9kZWxldGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRFTEVURSBSRVNVTFQgPT4gXCIgLCB3b3JkX2RlbGV0ZSAgKTtcclxuICAgICAgICAgICAgc2VsZi5teUluc2VydEhpc3Rvcnkod29yZF9pZCk7XHJcbiAgICAgICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiREVMRVRFIEVSUk9SID0+IFwiICwgZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG15SW5zZXJ0SGlzdG9yeSh3b3JkX2lkKXtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi5kYXRhYmFzZS5leGVjU1FMKFwiSU5TRVJUIElOVE8gSElTVE9SWSAod29yZF9pZCkgVkFMVUVTICg/KVwiLCBbd29yZF9pZF0pLnRoZW4od29yZF9pbnNlcnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgUkVTVUxUID0+IFwiICwgd29yZF9pbnNlcnQgICk7XHJcbiAgICAgICAgICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgRVJST1IgPT4gXCIgLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmZXRjaEpvaW4oKXtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJnbyB0byBmZXRjaCBKb2luIFwiKTtcclxuXHJcbiAgICAgICAgc2VsZi5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgaC5pZCwgaC53b3JkX2lkICwgZC5lbmdXb3JsZCAsIGQudGhhaVdvcmxkICwgZC50eXBlIEZST00gZGljdCBkIGpvaW4gSElTVE9SWSBoIG9uIGQuaWQgPSBoLndvcmRfaWQgT1JERVIgQlkgaC5pZCBERVNDXCIpLnRoZW4ocm93cyA9PntcclxuICAgICAgICAgICAgZm9yKHZhciByb3cgaW4gcm93cyl7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlc3VsdCA9PXZcIik7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8qZm9yKHZhciBpPTAgOyBpIDw9IHJvd3MubGVuZ3RoIDsgaSsrICl7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZXN1bHQgPT0+XCIgLCByb3dzW3Jvd11baV0pOyBcclxuICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZXN1bHQgYWxsID09PiBcIiAsIHJvd3Nbcm93XSk7Ly9yZXN1bHQgYWxsXHJcbiAgICAgICAgICAgICAgICAvKmNvbnNvbGUubG9nKFwiaWRfSGlzdG9yeSA9PT4gXCIgLCByb3dzW3Jvd11bMF0pOyAvLyByZXN1bHQgZW5nXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIndvcmRfaWQgPT0+IFwiICwgcm93c1tyb3ddWzFdKTsgLy8gcmVzdWx0IGVuZ1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlbmdfd29yZCA9PT4gXCIgLCByb3dzW3Jvd11bMl0pOyAvLyByZXN1bHQgZW5nXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInRoYWlfd29yZCA9PT4gXCIgLCByb3dzW3Jvd11bM10pOyAvL3Jlc3VsdCB0aGFpXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIndvcmRfdHlwZSA9PT4gXCIgLCByb3dzW3Jvd11bNF0pOyAvL3Jlc3VsdCB0aGFpKi9cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sZXJyb3IgPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU0VMRUNUIEVSUk9SIFwiICwgZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hhbmdXb3JkVHlwZShhcmcpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiY2hhbmdXb3JkVHlwZSA9PSB2XCIpO1xyXG4gICAgICAgIGxldCB3b3JkID0gYXJnO1xyXG5cclxuICAgICAgICBsZXQgd29yZEluZGV4T2YgPSB3b3JkLmluZGV4T2YoXCJbXCIpO1xyXG4gICAgICAgIGxldCB3b3JkTGFzdEluZGV4T2YgPSB3b3JkLmxhc3RJbmRleE9mKFwiXVwiKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIndvcmQgYXJnID09PSA+IFwiICwgd29yZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc29sZS5sb2coXCJpbmRleCBvZiA9PT09PSA+IFwiICwgd29yZEluZGV4T2YpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwibGFzdCBJbmRleG9mID09PT09ID4gXCIgLCB3b3JkTGFzdEluZGV4T2YpO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBpZih3b3JkSW5kZXhPZiA9PSAxICYmIHdvcmRMYXN0SW5kZXhPZiAhPSAtMSl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIHRydWUgdlwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIHdvcmQ7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIGVsc2UgdiBcIik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB3b3JkID0gXCJbXCIgKyB3b3JkICsgXCJdXCI7XHJcbiAgICAgICAgICAgIHJldHVybiB3b3JkO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICBcclxuXHQgIFxyXG4gICAgXHJcbiB9XHJcbiJdfQ==