"use strict";
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var observable_1 = require("data/observable");
var fs = require("file-system"); //เรียกใช้เพื่อเข้าถึง uri
var dialogs = require("ui/dialogs");
var Sqlite = require("nativescript-sqlite");
var http = require("http");
var sound = require("nativescript-sound"); //เรียกใช้ plugin sound
var ListDetailComponent = (function (_super) {
    __extends(ListDetailComponent, _super);
    function ListDetailComponent(route) {
        var _this = _super.call(this) || this;
        _this.route = route;
        _this.url = "http://translate.google.com/translate_tts?ie=UTF-8&tl=en&client=tw-ob&q="; // link สำหรับ load ไฟล์จาก google traslate
        var self = _this;
        _this.route.queryParams.subscribe(function (params) {
            console.log(JSON.stringify(params));
            self.word = JSON.parse(params["words"]); // ให้ตัวแปร self.word รับค่าจาก list main ด้วยรูป json โดยส่งมาในชื่อ words ด้วยคำสั่ง params["words"]
            console.log(self.word.id);
            console.log(self.word.dict_search);
            console.log(self.word.dict_meaning);
            self.favorite = 0;
            ; // ให้ favorite
            /*let temp = self.word.wordType;
            self.word.wordType = self.changWordType(temp);
            console.log(self.word.wordType);*/
            self.url = self.url + self.word.dict_search; //set word สำหรับค้นหา googletraslate
            self.setButtonSound(self.url);
            //เรียกเปิดใช้ Databasee
            new Sqlite("dicts.db").then(function (db) {
                self.database = db;
                console.log("Open database Success");
            }, function (error) {
                console.log("Open DB ERROR", error);
            });
        });
        return _this;
    }
    ListDetailComponent.prototype.ngOnInit = function () {
        var self = this;
        self.myHistory();
    };
    ListDetailComponent.prototype.myFavorite = function () {
        console.log("click Favorite");
        var self = this;
        var word_id = self.word.id;
        self.myCheckFavorite(word_id);
        /*
        if(self.favorite == 0 ){
            self.favorite = 1;
            self.database.execSQL("UPDATE dict SET favorite = (?) WHERE id = (?) " ,[self.favorite , self.word.id] , function(err , db ){
            if(err){
                console.log("error is == > " , err);
            }else{
                console.log("Update Success");
                
            }
        });

        }else if(self.favorite == 1){
            self.favorite = 0 ;
            self.database.execSQL("UPDATE dict SET favorite = (?) WHERE id = (?)" ,[self.favorite , self.word.id] , function(err , db ){
                if(err){
                    console.log("error is == > " , err);
                }else{
                    console.log("Update Success");
                
                }
            });
        }*/
    };
    ListDetailComponent.prototype.myCheckFavorite = function (word_id) {
        var self = this;
        self.database.all("SELECT * FROM FAVORITE WHERE dict_no = (?)", [word_id]).then(function (rows) {
            if (rows == "") {
                self.myInsertFavorite(word_id);
            }
            else {
                self.myDeleteFavoite(word_id);
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    ListDetailComponent.prototype.myInsertFavorite = function (word_id) {
        var self = this;
        self.database.execSQL("INSERT INTO FAVORITE (dict_no) VALUES (?)", [word_id]).then(function (word_insert) {
            console.log("INSERT RESULT => ", word_insert);
        }, function (error) {
            console.log("INSERT ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.myDeleteFavoite = function (word_id) {
        var self = this;
        self.database.execSQL("DELETE FROM FAVORITE WHERE dict_no = (?)", [word_id]).then(function (word_delete) {
            console.log("DELETE RESULT => ", word_delete);
            self.myInsertFavorite(word_id);
        }, function (error) {
            console.log("DELETE ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.myHistory = function () {
        var self = this;
        var word_id = self.word.id;
        self.myCheckHistory(word_id);
    };
    ListDetailComponent.prototype.myCheckHistory = function (word_id) {
        var self = this;
        self.database.all("SELECT * FROM HISTORY WHERE dict_no = (?)", [word_id]).then(function (rows) {
            if (rows == "") {
                self.myInsertHistory(word_id);
            }
            else {
                self.myDeleteHistory(word_id);
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    ListDetailComponent.prototype.myDeleteHistory = function (word_id) {
        var self = this;
        self.database.execSQL("DELETE FROM HISTORY WHERE dict_no = (?)", [word_id]).then(function (word_delete) {
            console.log("DELETE RESULT => ", word_delete);
            self.myInsertHistory(word_id);
        }, function (error) {
            console.log("DELETE ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.myInsertHistory = function (word_id) {
        var self = this;
        self.database.execSQL("INSERT INTO HISTORY (dict_no,dict_search) VALUES (?,?)", [word_id, self.word.dict_search]).then(function (word_insert) {
            console.log("INSERT RESULT => ", word_insert);
        }, function (error) {
            console.log("INSERT ERROR => ", error);
        });
    };
    ListDetailComponent.prototype.fetchJoin = function () {
        var self = this;
        console.log("go to fetch Join ");
        self.database.all("SELECT h.id, h.word_id , d.engWorld , d.thaiWorld , d.type FROM dict d join HISTORY h on d.id = h.word_id ORDER BY h.id DESC").then(function (rows) {
            for (var row in rows) {
                console.log("Result ==v");
                /*for(var i=0 ; i <= rows.length ; i++ ){
                    console.log("result ==>" , rows[row][i]);
                }*/
                console.log("result all ==> ", rows[row]); //result all
            }
        }, function (error) {
            console.log("SELECT ERROR ", error);
        });
    };
    ListDetailComponent.prototype.changWordType = function (arg) {
        console.log("changWordType == v");
        var word = arg;
        var wordIndexOf = word.indexOf("[");
        var wordLastIndexOf = word.lastIndexOf("]");
        console.log("word arg === > ", word);
        console.log("index of ===== > ", wordIndexOf);
        console.log("last Indexof ===== > ", wordLastIndexOf);
        if (wordIndexOf == 1 && wordLastIndexOf != -1) {
            console.log(" true v");
            return word;
        }
        else {
            console.log(" else v ");
            word = "[" + word + "]";
            return word;
        }
    };
    ListDetailComponent.prototype.sound_play = function () {
        console.log("Click Sound");
        var self = this;
        self.play_word.play();
    };
    ListDetailComponent.prototype.setButtonSound = function (arg) {
        console.log("Set button Sound");
        var self = this;
        var word = arg;
        var documents = fs.knownFolders.documents();
        var my_path = documents.getFolder("mySound");
        var filePath = fs.path.join(my_path.path, "test.mp3");
        http.getFile({ url: self.url,
            method: "GET",
            headers: {
                "Referer": 'http://translate.google.com/',
                "User-Agent": 'stagefright/1.2 (Linux;Android 5.0)',
                "Content-Type": 'audio/mpeg'
            }
        }, filePath).then(function (r) {
            //// Argument (response) is HttpResponse!
            console.log(JSON.stringify(r.path));
            self.play_word = sound.create(r.path);
        }, function (e) {
            console.log("error => ", e);
        });
    };
    return ListDetailComponent;
}(observable_1.Observable));
ListDetailComponent = __decorate([
    core_1.Component({
        selector: "ns-app",
        templateUrl: "views/list-detail/detail.html",
    }),
    __metadata("design:paramtypes", [router_1.ActivatedRoute])
], ListDetailComponent);
exports.ListDetailComponent = ListDetailComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0YWlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV0YWlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxzQ0FBa0Q7QUFHbEQsMENBQWlEO0FBR2pELDhDQUE2QztBQUM3QyxnQ0FBa0MsQ0FBRSwwQkFBMEI7QUFFOUQsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3BDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVDLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMzQixJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLHVCQUF1QjtBQU9sRSxJQUFhLG1CQUFtQjtJQUFTLHVDQUFVO0lBVTlDLDZCQUEyQixLQUFxQjtRQUFoRCxZQUNHLGlCQUFPLFNBZ0NWO1FBakMyQixXQUFLLEdBQUwsS0FBSyxDQUFnQjtRQUx6QyxTQUFHLEdBQUcsMEVBQTBFLENBQUMsQ0FBQSwyQ0FBMkM7UUFRaEksSUFBSSxJQUFJLEdBQUcsS0FBSSxDQUFDO1FBQ2hCLEtBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxVQUFBLE1BQU07WUFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFFLENBQUM7WUFDckMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsdUdBQXVHO1lBRWhKLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMxQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDbkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFB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UUFBUTtRQUNsQixXQUFXLEVBQUUsK0JBQStCO0tBQy9DLENBQUM7cUNBV3FDLHVCQUFjO0dBVnhDLG1CQUFtQixDQWdROUI7QUFoUVcsa0RBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBQYWdlUm91dGUgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWFuZ3VsYXIvcm91dGVyXCI7IFxyXG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyXCI7XHJcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xyXG5pbXBvcnQgeyBJdGVtIH0gZnJvbSBcIi4uLy4uL21vZGVscy9pdGVtcy9pdGVtXCI7XHJcbmltcG9ydCB7IFdvcmRJdGVtIH0gZnJvbSBcIi4uLy4uL21vZGVscy9pdGVtcy9pdGVtc193b3JkXCI7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdkYXRhL29ic2VydmFibGUnO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZmlsZS1zeXN0ZW1cIjsgIC8v4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4LmA4Lie4Li34LmI4Lit4LmA4LiC4LmJ4Liy4LiW4Li24LiHIHVyaVxyXG5cclxudmFyIGRpYWxvZ3MgPSByZXF1aXJlKFwidWkvZGlhbG9nc1wiKTtcclxudmFyIFNxbGl0ZSA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtc3FsaXRlXCIpO1xyXG52YXIgaHR0cCA9IHJlcXVpcmUoXCJodHRwXCIpO1xyXG52YXIgc291bmQgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXNvdW5kXCIpOyAvL+C5gOC4o+C4teC4ouC4geC5g+C4iuC5iSBwbHVnaW4gc291bmRcclxuXHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiBcIm5zLWFwcFwiLFxyXG4gICAgdGVtcGxhdGVVcmw6IFwidmlld3MvbGlzdC1kZXRhaWwvZGV0YWlsLmh0bWxcIixcclxufSlcclxuZXhwb3J0IGNsYXNzIExpc3REZXRhaWxDb21wb25lbnQgZXh0ZW5kcyBPYnNlcnZhYmxlIGltcGxlbWVudHMgT25Jbml0IHtcclxuIFxyXG4gICAgd29yZDpXb3JkSXRlbTsgICAgICAvL3dvcmQg4LiX4Li14LmI4LmE4LiU4LmJ4Lij4Lix4Lia4LmA4LiC4LmJ4Liy4Lih4Liy4LiI4Liy4LiBIGxzaXQgbWFpblxyXG4gICAgZmF2b3JpdGUgOiBhbnkgOyAgICAvLyBidXR0b24gb3V0cHV0IHNob3cgb24gbGF5b3V0XHJcblxyXG4gICAgcHJpdmF0ZSB1cmwgPSBcImh0dHA6Ly90cmFuc2xhdGUuZ29vZ2xlLmNvbS90cmFuc2xhdGVfdHRzP2llPVVURi04JnRsPWVuJmNsaWVudD10dy1vYiZxPVwiOy8vIGxpbmsg4Liq4Liz4Lir4Lij4Lix4LiaIGxvYWQg4LmE4Lif4Lil4LmM4LiI4Liy4LiBIGdvb2dsZSB0cmFzbGF0ZVxyXG4gICAgcHJpdmF0ZSBkYXRhYmFzZTsgLy8g4LiV4Lix4Lin4LmB4Lib4LijIERhdGFiYXNlXHJcbiAgICBwcml2YXRlIHBsYXlfd29yZDsgLy8g4LmA4Lil4LmI4LiZ4LmA4Liq4Li14Lii4LiHIHdvcmRcclxuXHJcblxyXG4gICAgIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcblxyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICB0aGlzLnJvdXRlLnF1ZXJ5UGFyYW1zLnN1YnNjcmliZShwYXJhbXMgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHBhcmFtcykgKTtcclxuICAgICAgICBzZWxmLndvcmQgPSBKU09OLnBhcnNlKHBhcmFtc1tcIndvcmRzXCJdKTsgLy8g4LmD4Lir4LmJ4LiV4Lix4Lin4LmB4Lib4LijIHNlbGYud29yZCDguKPguLHguJrguITguYjguLLguIjguLLguIEgbGlzdCBtYWluIOC4lOC5ieC4p+C4ouC4o+C4ueC4myBqc29uIOC5guC4lOC4ouC4quC5iOC4h+C4oeC4suC5g+C4meC4iuC4t+C5iOC4rSB3b3JkcyDguJTguYnguKfguKLguITguLPguKrguLHguYjguIcgcGFyYW1zW1wid29yZHNcIl1cclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coc2VsZi53b3JkLmlkKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhzZWxmLndvcmQuZGljdF9zZWFyY2gpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGYud29yZC5kaWN0X21lYW5pbmcpO1xyXG4gICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIHNlbGYuZmF2b3JpdGUgPSAwOzsgLy8g4LmD4Lir4LmJIGZhdm9yaXRlXHJcbiAgICAgICAgXHJcbiAgICAgICAgLypsZXQgdGVtcCA9IHNlbGYud29yZC53b3JkVHlwZTtcclxuICAgICAgICBzZWxmLndvcmQud29yZFR5cGUgPSBzZWxmLmNoYW5nV29yZFR5cGUodGVtcCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coc2VsZi53b3JkLndvcmRUeXBlKTsqL1xyXG5cclxuICAgICAgICBzZWxmLnVybCA9IHNlbGYudXJsICsgc2VsZi53b3JkLmRpY3Rfc2VhcmNoOy8vc2V0IHdvcmQg4Liq4Liz4Lir4Lij4Lix4Lia4LiE4LmJ4LiZ4Lir4LiyIGdvb2dsZXRyYXNsYXRlXHJcbiAgICAgICAgc2VsZi5zZXRCdXR0b25Tb3VuZChzZWxmLnVybCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy/guYDguKPguLXguKLguIHguYDguJvguLTguJTguYPguIrguYkgRGF0YWJhc2VlXHJcbiAgICAgICAgbmV3IFNxbGl0ZShcImRpY3RzLmRiXCIpLnRoZW4oZGIgPT57XHJcbiAgICAgICAgICAgIHNlbGYuZGF0YWJhc2UgPSBkYjtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJPcGVuIGRhdGFiYXNlIFN1Y2Nlc3NcIik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0sZXJyb3IgPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiT3BlbiBEQiBFUlJPUlwiICwgZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYubXlIaXN0b3J5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbXlGYXZvcml0ZSgpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiY2xpY2sgRmF2b3JpdGVcIik7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGxldCB3b3JkX2lkID0gc2VsZi53b3JkLmlkO1xyXG5cclxuICAgICAgICBzZWxmLm15Q2hlY2tGYXZvcml0ZSh3b3JkX2lkKTtcclxuICAgICAgICAvKlxyXG4gICAgICAgIGlmKHNlbGYuZmF2b3JpdGUgPT0gMCApe1xyXG4gICAgICAgICAgICBzZWxmLmZhdm9yaXRlID0gMTtcclxuICAgICAgICAgICAgc2VsZi5kYXRhYmFzZS5leGVjU1FMKFwiVVBEQVRFIGRpY3QgU0VUIGZhdm9yaXRlID0gKD8pIFdIRVJFIGlkID0gKD8pIFwiICxbc2VsZi5mYXZvcml0ZSAsIHNlbGYud29yZC5pZF0gLCBmdW5jdGlvbihlcnIgLCBkYiApe1xyXG4gICAgICAgICAgICBpZihlcnIpe1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciBpcyA9PSA+IFwiICwgZXJyKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVwZGF0ZSBTdWNjZXNzXCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfWVsc2UgaWYoc2VsZi5mYXZvcml0ZSA9PSAxKXtcclxuICAgICAgICAgICAgc2VsZi5mYXZvcml0ZSA9IDAgO1xyXG4gICAgICAgICAgICBzZWxmLmRhdGFiYXNlLmV4ZWNTUUwoXCJVUERBVEUgZGljdCBTRVQgZmF2b3JpdGUgPSAoPykgV0hFUkUgaWQgPSAoPylcIiAsW3NlbGYuZmF2b3JpdGUgLCBzZWxmLndvcmQuaWRdICwgZnVuY3Rpb24oZXJyICwgZGIgKXtcclxuICAgICAgICAgICAgICAgIGlmKGVycil7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciBpcyA9PSA+IFwiICwgZXJyKTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXBkYXRlIFN1Y2Nlc3NcIik7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSovXHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBteUNoZWNrRmF2b3JpdGUod29yZF9pZCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYuZGF0YWJhc2UuYWxsKFwiU0VMRUNUICogRlJPTSBGQVZPUklURSBXSEVSRSBkaWN0X25vID0gKD8pXCIsW3dvcmRfaWRdKS50aGVuKHJvd3MgPT57XHJcbiAgICAgICAgICAgIGlmKHJvd3MgPT1cIlwiKXtcclxuICAgICAgICAgICAgICAgIHNlbGYubXlJbnNlcnRGYXZvcml0ZSh3b3JkX2lkKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBzZWxmLm15RGVsZXRlRmF2b2l0ZSh3b3JkX2lkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sZXJyb3IgPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU0VMRUNUIEVSUk9SIFwiICwgZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBteUluc2VydEZhdm9yaXRlKHdvcmRfaWQpe1xyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICBzZWxmLmRhdGFiYXNlLmV4ZWNTUUwoXCJJTlNFUlQgSU5UTyBGQVZPUklURSAoZGljdF9ubykgVkFMVUVTICg/KVwiLCBbd29yZF9pZF0pLnRoZW4od29yZF9pbnNlcnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgUkVTVUxUID0+IFwiICwgd29yZF9pbnNlcnQgICk7XHJcbiAgICAgICAgICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgRVJST1IgPT4gXCIgLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBteURlbGV0ZUZhdm9pdGUod29yZF9pZCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYuZGF0YWJhc2UuZXhlY1NRTChcIkRFTEVURSBGUk9NIEZBVk9SSVRFIFdIRVJFIGRpY3Rfbm8gPSAoPylcIiwgW3dvcmRfaWRdKS50aGVuKHdvcmRfZGVsZXRlID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJERUxFVEUgUkVTVUxUID0+IFwiICwgd29yZF9kZWxldGUgICk7XHJcbiAgICAgICAgICAgIHNlbGYubXlJbnNlcnRGYXZvcml0ZSh3b3JkX2lkKTtcclxuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJERUxFVEUgRVJST1IgPT4gXCIgLCBlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIG15SGlzdG9yeSgpe1xyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICBsZXQgd29yZF9pZCA9IHNlbGYud29yZC5pZDtcclxuICAgICAgICBzZWxmLm15Q2hlY2tIaXN0b3J5KHdvcmRfaWQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG15Q2hlY2tIaXN0b3J5KHdvcmRfaWQpe1xyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgKiBGUk9NIEhJU1RPUlkgV0hFUkUgZGljdF9ubyA9ICg/KVwiLFt3b3JkX2lkXSkudGhlbihyb3dzID0+e1xyXG4gICAgICAgICAgICBpZihyb3dzID09XCJcIil7XHJcbiAgICAgICAgICAgICAgICBzZWxmLm15SW5zZXJ0SGlzdG9yeSh3b3JkX2lkKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBzZWxmLm15RGVsZXRlSGlzdG9yeSh3b3JkX2lkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sZXJyb3IgPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU0VMRUNUIEVSUk9SIFwiICwgZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBteURlbGV0ZUhpc3Rvcnkod29yZF9pZCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLmRhdGFiYXNlLmV4ZWNTUUwoXCJERUxFVEUgRlJPTSBISVNUT1JZIFdIRVJFIGRpY3Rfbm8gPSAoPylcIiwgW3dvcmRfaWRdKS50aGVuKHdvcmRfZGVsZXRlID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJERUxFVEUgUkVTVUxUID0+IFwiICwgd29yZF9kZWxldGUgICk7XHJcbiAgICAgICAgICAgIHNlbGYubXlJbnNlcnRIaXN0b3J5KHdvcmRfaWQpO1xyXG4gICAgICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRFTEVURSBFUlJPUiA9PiBcIiAsIGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBteUluc2VydEhpc3Rvcnkod29yZF9pZCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYuZGF0YWJhc2UuZXhlY1NRTChcIklOU0VSVCBJTlRPIEhJU1RPUlkgKGRpY3Rfbm8sZGljdF9zZWFyY2gpIFZBTFVFUyAoPyw/KVwiLCBbd29yZF9pZCxzZWxmLndvcmQuZGljdF9zZWFyY2hdKS50aGVuKHdvcmRfaW5zZXJ0ID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSU5TRVJUIFJFU1VMVCA9PiBcIiAsIHdvcmRfaW5zZXJ0ICApO1xyXG4gICAgICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSU5TRVJUIEVSUk9SID0+IFwiICwgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZmV0Y2hKb2luKCl7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiZ28gdG8gZmV0Y2ggSm9pbiBcIik7XHJcblxyXG4gICAgICAgIHNlbGYuZGF0YWJhc2UuYWxsKFwiU0VMRUNUIGguaWQsIGgud29yZF9pZCAsIGQuZW5nV29ybGQgLCBkLnRoYWlXb3JsZCAsIGQudHlwZSBGUk9NIGRpY3QgZCBqb2luIEhJU1RPUlkgaCBvbiBkLmlkID0gaC53b3JkX2lkIE9SREVSIEJZIGguaWQgREVTQ1wiKS50aGVuKHJvd3MgPT57XHJcbiAgICAgICAgICAgIGZvcih2YXIgcm93IGluIHJvd3Mpe1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZXN1bHQgPT12XCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvKmZvcih2YXIgaT0wIDsgaSA8PSByb3dzLmxlbmd0aCA7IGkrKyApe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVzdWx0ID09PlwiICwgcm93c1tyb3ddW2ldKTsgXHJcbiAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVzdWx0IGFsbCA9PT4gXCIgLCByb3dzW3Jvd10pOy8vcmVzdWx0IGFsbFxyXG4gICAgICAgICAgICAgICAgLypjb25zb2xlLmxvZyhcImlkX0hpc3RvcnkgPT0+IFwiICwgcm93c1tyb3ddWzBdKTsgLy8gcmVzdWx0IGVuZ1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ3b3JkX2lkID09PiBcIiAsIHJvd3Nbcm93XVsxXSk7IC8vIHJlc3VsdCBlbmdcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZW5nX3dvcmQgPT0+IFwiICwgcm93c1tyb3ddWzJdKTsgLy8gcmVzdWx0IGVuZ1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ0aGFpX3dvcmQgPT0+IFwiICwgcm93c1tyb3ddWzNdKTsgLy9yZXN1bHQgdGhhaVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ3b3JkX3R5cGUgPT0+IFwiICwgcm93c1tyb3ddWzRdKTsgLy9yZXN1bHQgdGhhaSovXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LGVycm9yID0+e1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNFTEVDVCBFUlJPUiBcIiAsIGVycm9yKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoYW5nV29yZFR5cGUoYXJnKXtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImNoYW5nV29yZFR5cGUgPT0gdlwiKTtcclxuICAgICAgICBsZXQgd29yZCA9IGFyZztcclxuXHJcbiAgICAgICAgbGV0IHdvcmRJbmRleE9mID0gd29yZC5pbmRleE9mKFwiW1wiKTtcclxuICAgICAgICBsZXQgd29yZExhc3RJbmRleE9mID0gd29yZC5sYXN0SW5kZXhPZihcIl1cIik7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJ3b3JkIGFyZyA9PT0gPiBcIiAsIHdvcmQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiaW5kZXggb2YgPT09PT0gPiBcIiAsIHdvcmRJbmRleE9mKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImxhc3QgSW5kZXhvZiA9PT09PSA+IFwiICwgd29yZExhc3RJbmRleE9mKTtcclxuICAgICAgICBcclxuXHJcbiAgICAgICAgaWYod29yZEluZGV4T2YgPT0gMSAmJiB3b3JkTGFzdEluZGV4T2YgIT0gLTEpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiB0cnVlIHZcIik7XHJcbiAgICAgICAgICAgIHJldHVybiB3b3JkO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiBlbHNlIHYgXCIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgd29yZCA9IFwiW1wiICsgd29yZCArIFwiXVwiO1xyXG4gICAgICAgICAgICByZXR1cm4gd29yZDtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc291bmRfcGxheSgpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ2xpY2sgU291bmRcIik7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYucGxheV93b3JkLnBsYXkoKTtcclxuXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0QnV0dG9uU291bmQoYXJnKXtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlNldCBidXR0b24gU291bmRcIik7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGxldCB3b3JkID0gYXJnO1xyXG5cclxuICAgICAgICBsZXQgZG9jdW1lbnRzID0gZnMua25vd25Gb2xkZXJzLmRvY3VtZW50cygpO1xyXG4gICAgICAgIGxldCBteV9wYXRoID0gZG9jdW1lbnRzLmdldEZvbGRlcihcIm15U291bmRcIik7XHJcbiAgICAgICAgdmFyIGZpbGVQYXRoID0gZnMucGF0aC5qb2luKG15X3BhdGgucGF0aCwgXCJ0ZXN0Lm1wM1wiKTtcclxuXHJcbiAgICAgICAgaHR0cC5nZXRGaWxlKHsgdXJsOiBzZWxmLnVybCxcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlJlZmVyZXJcIiA6ICdodHRwOi8vdHJhbnNsYXRlLmdvb2dsZS5jb20vJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJVc2VyLUFnZW50XCIgOiAnc3RhZ2VmcmlnaHQvMS4yIChMaW51eDtBbmRyb2lkIDUuMCknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiAnYXVkaW8vbXBlZydcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sZmlsZVBhdGgpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgLy8vLyBBcmd1bWVudCAocmVzcG9uc2UpIGlzIEh0dHBSZXNwb25zZSFcclxuICAgICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoci5wYXRoKSk7XHJcbiAgICAgICAgICAgIHNlbGYucGxheV93b3JkID0gc291bmQuY3JlYXRlKHIucGF0aCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciA9PiBcIiAsIGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgIFxyXG5cdCAgXHJcbiAgICBcclxuIH1cclxuIl19